var Card=function(a,b){this.sign=b;this.value=a};var Player=function(a){this.name=a;this.cards=[];this.points=0;this.count_cards=0};var Game=function(i){const h=12;const c=3;this.return_the_bigest=h;this.return_count_of_stack=c;this.count_players=i;this.current_player;this.players=[];this.player_cards;this.stack=[null,null,null,null];this.can_move;this.win=false;var e=this;var f=function(){for(var g in e.player_cards){if(e.player_cards[g]!=null){if(e.player_cards[g].value==0){return true}for(var j in e.stack){if(e.stack[j]!=null&&e.player_cards[g].sign==j&&e.player_cards[g].value-1==e.stack[j].value){return true}}}}return false};var d=function(){var k=[];for(var n=0;n<=h;n++){for(var j=0;j<=c;j++){k.push(new Card(n,j))}}for(var g in k){var l=Math.floor(Math.random()*(k.length-1));var m=k[g];k[g]=k[l];k[l]=m}for(var g in k){e.players[g%e.count_players].cards.push(k[g]);e.players[g%e.count_players].count_cards+=1;e.players[g%e.count_players].points-=10}};var b=function(){for(var g=0;g<e.count_players;g++){e.players.push(new Player("#"+g))}e.players[0].name="TY";d();e.current_player=0;e.player_cards=e.players[e.current_player].cards;e.can_move=f()};var a=function(g){e.players[e.current_player].points+=g};this.next_player=function(){if(this.players[this.current_player].count_cards==0){a(70);this.win=true;this.game_start=false;alert("Koniec Gry !!! \n Wygrał gracz: "+this.players[this.current_player].name)}if(!this.win&&!this.can_move){this.current_player++;this.current_player%=this.count_players;this.player_cards=this.players[this.current_player].cards;this.can_move=f();return true}else{return false}};this.try_give_cards=function(j,g){if(this.can_move&&this.player_cards[j]!=null&&this.player_cards[j].sign==g&&(this.player_cards[j].value==0||(this.stack[g]!=null&&(this.player_cards[j].value-1==this.stack[g].value)))){this.stack[g]=this.player_cards[j];this.player_cards[j]=null;this.can_move=false;a(10);if(this.stack[g].value==h){a(50)}this.players[this.current_player].count_cards-=1;return true}else{return false}};b()};var AI=function(a){this.gameView=a;this.game=this.gameView.game;this.play=function(){while(this.game.current_player!=0&&!this.game.win){this.gameView.update_all();if(!this.game.next_player()&&!this.game.win){if(Math.floor(Math.random()*1)==0){for(var b in this.game.player_cards){if(this.game.player_cards[b]!=null&&this.game.try_give_cards(b,this.game.player_cards[b].sign)){break}}}else{for(var b=this.game.player_cards.length-1;b>=0;b--){if(this.game.player_cards[b]!=null&&this.game.try_give_cards(b,this.game.player_cards[b].sign)){break}}}}}}};var GameView=function(){const a=13;const c=1;var d=3;this.game_start=false;this.game;var b=this;this.show_count_players=function(){$("#count_players").text(d)};this.show_current_player=function(e){$("#current_player").text(e)};this.craete_players_statistics=function(f){$("#statistics table td").remove();for(var e in f){$("#statistics table tr.name th").after("<td>"+f[e].name+"</td>");$("#statistics table tr.points th").after("<td>"+f[e].points+"</td>");$("#statistics table tr.count_cards th").after("<td>"+f[e].count_cards)}};this.update_players_statistics=function(f){for(var e in f){$("#statistics table tr.points td:eq("+(f.length-e-1)+")").text(f[e].points);$("#statistics table tr.count_cards td:eq("+(f.length-e-1)+")").text(f[e].count_cards)}};this.can_move_control_lamp=function(){$("#can_move").removeClass();if(this.game.current_player!=0){$("#can_move").addClass("orange")}else{if(!this.game.can_move){$("#can_move").addClass("red")}else{$("#can_move").addClass("green")}}};this.show_cards=function(g){$("#my_area .cards").empty();var f=0;for(var e in g){if(g[e]==null){f++}else{$("#my_area .cards").append("<li></li>");$("#my_area .cards li:eq("+(e-f)+")").text(g[e].value);$("#my_area .cards li:eq("+(e-f)+")").attr({index:e,sign:g[e].sign,value:g[e].value});if(g[e].value==this.game.return_the_bigest){$("#my_area .cards li:eq("+(e-f)+")").attr({the_biggest:true})}else{$("#my_area .cards li:eq("+(e-f)+")").attr({the_biggest:false})}}}$("#my_area .cards li").draggable({revert:true})};this.show_stack=function(f){for(var e in f){if(f[e]==null){$("#board .cards li:eq("+e+")").text("");$("#board .cards li:eq("+e+")").attr({value:null,the_biggest:false})}else{$("#board .cards li:eq("+e+")").text(f[e].value);$("#board .cards li:eq("+e+")").attr({value:f[e].value});if(f[e].value==this.game.return_the_bigest){$("#board .cards li:eq("+e+")").attr({the_biggest:true})}else{$("#board .cards li:eq("+e+")").attr({the_biggest:false})}}}};this.create_all=function(){this.show_current_player(this.game.current_player);this.craete_players_statistics(this.game.players);this.show_stack(this.game.stack);this.show_cards(this.game.player_cards);this.can_move_control_lamp()};this.update_all=function(){this.show_current_player(this.game.current_player);this.update_players_statistics(this.game.players);this.show_stack(this.game.stack);this.can_move_control_lamp()};$("#add_player").click(function(){if(d+1<=a){d++}b.show_count_players()});$("#remove_player").click(function(){if(d-1>=c){d--}b.show_count_players()});$("#game_start").click(function(){if(!b.game_start){b.game=new Game(d);ai=new AI(b);b.create_all();$(this).text("Reset");$("#add_player, #remove_player").attr("disabled",true)}else{$(this).text("Nowa Gra");$("#add_player, #remove_player").attr("disabled",false)}b.game_start=!b.game_start});$("#accept").click(function(){if(b.game.current_player==0){if(b.game.can_move==true){alert("Wykonaj Ruch !")}else{b.game.next_player();ai.play();b.update_all()}}else{alert("Nie twój Ruch !")}});$("#can_move").click(function(){alert(b.game.can_move)});$("#board .cards li").droppable({over:function(e,f){if(b.game.current_player==0&&b.game.try_give_cards(f.draggable.attr("index"),$(this).attr("sign"))){f.draggable.remove();b.update_all()}}});b.show_count_players();b.show_current_player("-")};$(document).ready(function(){var a=new GameView()});
